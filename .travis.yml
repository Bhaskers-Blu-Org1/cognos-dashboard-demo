---
language: node_js
node_js:
  - "7"

before_install:
  - npm install -g @angular/cli
  - sudo pip install yamllint
  - npm install -g envsub

before_script:
  - "./tests/test-yamllint.sh"

script:
  - envsub --env SEGMENT_KEY=$SEGMENT_KEY ./src/environments/environment.prod.ts
  - ng build --env=prod

deploy:
  provider: cloudfoundry
  api: https://api.ng.bluemix.net
  username: $BLUEMIX_USER_PROD
  password: $BLUEMIX_PASS_PROD
  organization: $BLUEMIX_ORGANIZATION_PROD
  space: $BLUEMIX_SPACE_PROD
  "on":
    repo: GearBox/DDE-ang-node-test
    branch: production
